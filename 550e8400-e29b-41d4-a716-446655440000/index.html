<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace S√©curis√© ‚Äî L'√âcrin des Rendez-vous du 5</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root{
            --mauve-1: #2b0b2f;
            --mauve-2: #3b0f4a;
            --violet-deep: #190824;
            --emerald: #00c38a;
            --electric-blue: #00a8ff;
            --mustard: #d4a017;
            --text: #efe9ff;
            --muted: rgba(255,255,255,0.14);
        }
        html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--text);}
        body{
            background: linear-gradient(160deg,var(--mauve-1) 10%, var(--mauve-2) 60%, var(--violet-deep) 100%);
            display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:20px;padding:36px 18px;overflow-x:hidden;
            transition:opacity .9s ease, transform .6s ease;opacity:0;transform:translateY(6px);
        }
        body.visible{opacity:1;transform:none}
        header{width:100%;max-width:1100px;display:flex;justify-content:space-between;align-items:center;gap:12px}
        .brand{display:flex;flex-direction:column}
        .brand h2{font-family:'Playfair Display',serif;margin:0;font-weight:600;letter-spacing:0.2em;font-size:26px;color:var(--text)}
        .counter{font-size:13px;color:var(--muted);}

        main{width:100%;max-width:1100px}

        /* Timeline: responsive grid so items adapt to available width */
        .timeline{
            display:grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap:18px;
            padding:26px 12px;
            justify-items:center;
            align-items:start;
        }
        .bubble{
            width:100%;
            max-width:160px;
            min-height:110px;
            border-radius:16px;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));
            display:flex;
            flex-direction:column;
            align-items:stretch;
            justify-content:flex-start;
            backdrop-filter:blur(6px);
            position:relative;
            cursor:pointer;
            transition:transform .25s ease,box-shadow .25s ease;
            border:1px solid rgba(255,255,255,0.03);
            padding:10px;
            box-sizing:border-box;
        }
        /* month label should take remaining vertical space and align at bottom */
        .bubble .month-label{font-size:13px;color:var(--muted);margin-top:auto;text-align:center;display:block}
        .bubble .lock-icon{font-size:28px;color:var(--mustard);align-self:center}
        .bubble img{width:100%;height:72px;border-radius:8px;object-fit:cover;box-shadow:0 3px 10px rgba(0,0,0,0.5);display:block}
        .bubble.future img{display:none}
        .bubble p{margin:6px 0 0;font-size:13px;color:var(--muted)}
        .bubble.past{filter:grayscale(0.3);opacity:0.9}
        .bubble.current{box-shadow:0 0 24px rgba(0,195,138,0.18);border:2px solid rgba(0,195,138,0.12);transform:scale(1.06)}
        .bubble.future{filter:grayscale(1);opacity:0.5}
        .bubble .lock{position:absolute;right:8px;top:8px;color:var(--mustard);font-weight:700}

        /* Secret section */
        #secret-section{margin-top:48px;padding:28px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;flex-direction:column;gap:16px}
        #secret-section h3{font-family:'Playfair Display',serif;margin:0;font-size:20px}
        .key-row{display:flex;gap:10px;align-items:center}
        .key-row input{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);outline:none}
        .key-row button{padding:10px 14px;border-radius:8px;border:none;background:var(--mustard);color:#1a1110;font-weight:600;cursor:pointer;transition:filter .15s}
        .key-row button:hover{filter:brightness(1.06)}

        /* Scratch card */
        .scratch-wrap{position:relative;width:100%;max-width:720px;height:320px;margin-top:12px;border-radius:12px;overflow:hidden}
        .reveal{position:absolute;inset:0;background:linear-gradient(180deg,#3b0f4a,#2b0b2f);display:flex;align-items:center;justify-content:center;padding:24px;text-align:center}
        .reveal h1{font-family:'Playfair Display',serif;font-size:28px;margin:0;color:var(--text)}
        .overlay{position:absolute;inset:0;background:linear-gradient(90deg,#c9a94b,#f3d98a);display:block;cursor:crosshair}
        .poem{color:var(--muted);font-size:15px}

        /* Micro-interactions */
        .bubble:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.45)}

        @media (max-width:900px){
            .bubble{max-width:120px;min-height:90px;border-radius:12px;padding:8px}
            .reveal h1{font-size:20px;height:auto}
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <h2>Notre Histoire</h2>
            <div class="counter" id="meet-counter" data-meet-date="2023-08-05">Depuis notre rencontre : ‚Äî</div>
        </div>
        <div style="text-align:right">
            <a href="tente-ta-chance.html" style="display:inline-block;padding:8px 12px;background:var(--mustard);color:#1a1110;border-radius:8px;font-weight:600;text-decoration:none;font-size:13px">Tentes ta chance</a>
        </div>
    </header>

    <main>
        <section aria-label="Les Rendez-vous du 5" class="timeline" id="timeline">
            <!-- Les bulles sont g√©n√©r√©es dynamiquement pour 2026 par le script ci-dessous -->
        </section>
        <script>
            (function(){
                const monthNames = ['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'];
                const timeline = document.getElementById('timeline');
                if(!timeline) return;
                timeline.innerHTML = '';
                const year = 2026;
                const today = new Date();
                for(let m=1;m<=12;m++){
                    const id = `etape-${year}-${String(m).padStart(2,'0')}-05`;
                    const href = `etape-${year}-${String(m).padStart(2,'0')}-05.html`;
                    const unlockDate = new Date(year,m-1,5,0,0,0,0);
                    const a = document.createElement('a');
                    a.id = id;
                    a.href = href;
                    a.className = 'bubble';
                    if(today.getFullYear()===year && today.getMonth()+1===m && today.getDate()===5){ a.classList.add('current'); }
                    else if(today >= unlockDate){ a.classList.add('past'); }
                    else { a.classList.add('future'); }
                    const seed = encodeURIComponent(`${year}-${m}`);
                    if(today >= unlockDate){
                        // show image + month label for unlocked/past/current
                        const imgUrl = `https://picsum.photos/seed/${seed}/200`;
                        a.innerHTML = `<img src="${imgUrl}" alt="${monthNames[m-1]}"><div class="month-label">${monthNames[m-1]}</div>`;
                    } else {
                        // future months: leave content minimal ‚Äî the auto-timeline overlay will add the lock
                        a.innerHTML = `<div class="month-label">${monthNames[m-1]}</div>`;
                    }
                    a.dataset.unlock = unlockDate.toISOString();
                    a.dataset.href = href;
                    a.addEventListener('click', function(e){
                        e.preventDefault();
                        const unlock = new Date(a.dataset.unlock);
                        const now = new Date();
                        if(now < unlock){
                            a.animate([{transform:'scale(1)'},{transform:'scale(0.96)'},{transform:'scale(1)'}],{duration:220});
                            return;
                        }
                        const stored = (localStorage.getItem('rendezvous-auth') || sessionStorage.getItem('rendezvous-auth'));
                        if(stored && stored.length>10){ window.location.href = a.dataset.href; return; }
                        const attempt = prompt('Entrez la cl√© d\'acc√®s pour ouvrir cette √©tape :');
                        if(!attempt) return;
                        const h = CryptoJS.SHA256(attempt.trim().toLowerCase()).toString().toLowerCase();
                        const HASH_EXPECTED = '561f2d42ea28b8e600dcd1fe3fb9ace2739907331487f00fdba6196806606c42';
                        if(h === HASH_EXPECTED){ try{ localStorage.setItem('rendezvous-auth', HASH_EXPECTED); sessionStorage.setItem('rendezvous-auth', HASH_EXPECTED);}catch(e){}; window.location.href = a.dataset.href; }
                        else { alert('Cl√© invalide.'); }
                    });
                    timeline.appendChild(a);
                }
            })();
        </script>

        <!-- scratch link moved to header -->
    </main>

    <div id="status">üîí Syst√®me de v√©rification actif...</div>

    <script>
        // Conservons l'acc√®s initial (cl√© 'wapiti' d√©j√† en SHA-256)
        const HASH_ATTENDU = "561f2d42ea28b8e600dcd1fe3fb9ace2739907331487f00fdba6196806606c42";

        function verifier(){
            // If a valid auth token is stored, accept it and skip prompting.
            try{
                const stored = localStorage.getItem('rendezvous-auth') || sessionStorage.getItem('rendezvous-auth');
                if(stored && stored.toLowerCase() === HASH_ATTENDU.toLowerCase()){
                    document.getElementById('status').style.display='none';
                    document.body.classList.add('visible');
                    return;
                }
            }catch(e){ /* storage might be blocked */ }

            // Otherwise ask once and store the successful hash for the session/local browsing.
            const mdpSaisi = prompt("Veuillez entrer la cl√© d'acc√®s :");
            if(!mdpSaisi){ window.location.href = "https://www.google.com"; return; }
            const motNettoye = mdpSaisi.trim().toLowerCase();
            const hashSaisie = CryptoJS.SHA256(motNettoye).toString().toLowerCase();
            if(hashSaisie === HASH_ATTENDU){
                    document.getElementById('status').style.display='none';
                    document.body.classList.add('visible');
                    try{ localStorage.setItem('rendezvous-auth', HASH_ATTENDU); sessionStorage.setItem('rendezvous-auth', HASH_ATTENDU); }catch(e){}
            } else { alert('Cl√© invalide.'); window.location.href = 'https://www.google.com'; }
        }

        window.onload = () => {
            verifier();
            startCounter();
            initParallax();
        };

        // Counter depuis la date de rencontre (data attribute)
        function startCounter(){
            const el = document.getElementById('meet-counter');
            const d = new Date(el.dataset.meetDate || new Date());
            function update(){
                const now = new Date();
                const diff = Math.floor((now - d) / (1000*60*60*24));
                const years = Math.floor(diff/365);
                const days = diff - years*365;
                el.textContent = `Depuis notre rencontre : ${years} ans et ${days} jours`;
            }
            update(); setInterval(update,60*1000);
        }

        // Parallaxe simple: translate images slightly on scroll
        function initParallax(){
            const timeline = document.getElementById('timeline');
            timeline.addEventListener('scroll', e => {
                const bubbles = timeline.querySelectorAll('.bubble img');
                bubbles.forEach((img,i) => {
                    const rect = img.getBoundingClientRect();
                    const shift = (rect.top - window.innerHeight/2) * 0.02;
                    img.style.transform = `translateY(${shift}px)`;
                });
            });
        }

    </script>

    <script src="auto-timeline.js"></script>

</body>
</html>